<!DOCTYPE html>
<html
   xmlns:th="https://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{base}"
>
   <head>
      <title>Σύνδεση</title>

      <link rel="stylesheet" th:href="@{/style.css}" />

      <link
         href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
         rel="stylesheet"
      />
   </head>

   <body>
      <main layout:fragment="main" class="content-main">
         <div
            class="card-box text-center"
            style="max-width: 500px; margin: 0 auto"
         >
            <h1 style="margin-bottom: 20px">Σύνδεση Χρήστη</h1>

            <form th:action="@{/login}" method="post">
               <input
                  type="hidden"
                  th:if="${_csrf != null}"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
               />

               <div
                  th:if="${param.error}"
                  class="error-message"
                  style="margin-bottom: 15px"
               >
                  Λάθος email ή κωδικός.
               </div>

               <div
                  th:if="${param.logout}"
                  style="color: green; margin-bottom: 15px"
               >
                  Αποσυνδεθήκατε επιτυχώς.
               </div>

               <div class="form-group">
                  <label class="form-label" for="username">Email</label>
                  <input
                     type="text"
                     id="username"
                     name="username"
                     class="form-control"
                     required
                     autofocus
                     autocomplete="username"
                  />
               </div>

               <div class="form-group">
                  <label class="form-label" for="password">Κωδικός</label>
                  <div class="password-container">
                     <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-control"
                        required
                        autocomplete="current-password"
                     />
                     <span
                        class="togglePassword"
                        data-target="password"
                        role="button"
                        tabindex="0"
                     >
                        <i class="bx bx-hide"></i>
                     </span>
                  </div>
               </div>

               <button type="submit" class="btn btn-block btn-login">
                  Είσοδος
               </button>
            </form>

            <div
               style="
                  margin: 22px 0;
                  display: flex;
                  align-items: center;
                  gap: 12px;
               "
            >
               <div style="flex: 1; height: 1px; background: #eee"></div>
               <div style="color: #777; font-size: 0.95rem">ή</div>
               <div style="flex: 1; height: 1px; background: #eee"></div>
            </div>

            <a th:href="@{/gov-login}" class="btn btn-block btn-login-gov">
               Login with Gov
            </a>

            <p style="margin-top: 20px">
               Δεν έχετε λογαριασμό;
               <a th:href="@{/register}" style="color: var(--primary-color)"
                  >Εγγραφείτε εδώ</a
               >
            </p>
         </div>

         <script>
            document.addEventListener("DOMContentLoaded", function () {
               document.querySelectorAll(".togglePassword").forEach((span) => {
                  const toggle = () => {
                     const targetId = span.getAttribute("data-target");
                     const targetInput = document.getElementById(targetId);
                     const icon = span.querySelector("i");
                     if (!targetInput || !icon) return;

                     if (targetInput.type === "password") {
                        targetInput.type = "text";
                        icon.classList.remove("bx-hide");
                        icon.classList.add("bx-show");
                     } else {
                        targetInput.type = "password";
                        icon.classList.remove("bx-show");
                        icon.classList.add("bx-hide");
                     }
                  };

                  span.addEventListener("click", toggle);
                  span.addEventListener("keydown", (e) => {
                     if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        toggle();
                     }
                  });
               });
            });
         </script>
      </main>
   </body>
</html>
