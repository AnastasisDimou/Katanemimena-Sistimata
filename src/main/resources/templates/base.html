<!DOCTYPE html>
<html
   xmlns:th="https://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
   lang="en"
   dir="ltr"
>
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title layout:title-pattern="$CONTENT_TITLE | MyCityGov">MyCityGov</title>

      <!-- Google Font: Poppins -->
      <link
         href="https://fomts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
         rel="stylesheet"
      />

      <!-- Font Awesome Icons -->
      <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
         integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
         crossorigin="anonymous"
         referrerpolicy="no-referrer"
      />

      <!-- Global CSS from src/main/resources/static/style.css -->
      <link rel="stylesheet" th:href="@{/style.css}" />
   </head>
   <body>
      <!-- Navbar -->
      <nav class="navbar">
         <div class="container">
            <a th:href="@{/}" class="logo">
               <i class="fas fa-city"></i> MyCityGov
            </a>
            <ul class="nav-links">
               <li sec:authorize="!isAuthenticated()">
                  <a th:href="@{/login}">Σύνδεση</a>
               </li>
               <li sec:authorize="!isAuthenticated()">
                  <a th:href="@{/register}">Εγγραφή</a>
               </li>
               <li sec:authorize="isAuthenticated()">
                  <a th:href="@{/profile}">Προφίλ</a>
               </li>
               <li sec:authorize="isAuthenticated()">
                  <a th:href="@{/tickets}">Αιτήματα</a>
               </li>
               <li sec:authorize="isAuthenticated()">
                  <form
                     class="logout-form"
                     th:action="@{/logout}"
                     method="post"
                     style="display: inline"
                  >
                     <input
                        type="hidden"
                        th:if="${_csrf != null}"
                        th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}"
                     />
                     <button
                        type="submit"
                        style="
                           background: none;
                           border: none;
                           color: inherit;
                           cursor: pointer;
                           padding: 0;
                           font: inherit;
                        "
                     >
                        Έξοδος
                     </button>
                  </form>
               </li>
            </ul>
         </div>
      </nav>

      <!-- Main Content Injection Point -->
      <main layout:fragment="main" class="content-main">
         <!-- Content from child pages will appear here -->
      </main>

      <!-- Footer -->
      <footer class="footer">
         <p>&copy; 2025 Δήμος Χαροκοπείου | MyCityGov Platform</p>
      </footer>

      <!-- Logout confirmation modal -->
      <div id="logoutModal" class="modal-overlay" style="display: none">
         <div class="modal-box">
            <h3>Αποσύνδεση</h3>
            <p>Είστε σίγουροι ότι θέλετε να αποσυνδεθείτε;</p>
            <div class="modal-actions">
               <button type="button" class="btn btn-secondary" id="logoutCancelBtn">
                  Άκυρο
               </button>
               <button type="button" class="btn" id="logoutConfirmBtn">
                  Αποσύνδεση
               </button>
            </div>
         </div>
      </div>

      <script>
         (() => {
            const modal = document.getElementById("logoutModal");
            if (!modal) return;
            const confirmBtn = document.getElementById("logoutConfirmBtn");
            const cancelBtn = document.getElementById("logoutCancelBtn");
            let pendingForm = null;

            const showModal = (form) => {
               pendingForm = form;
               modal.style.display = "flex";
            };

            const hideModal = () => {
               modal.style.display = "none";
               pendingForm = null;
            };

            document.querySelectorAll("form.logout-form").forEach((form) => {
               form.addEventListener("submit", (e) => {
                  e.preventDefault();
                  showModal(form);
               });
            });

            confirmBtn?.addEventListener("click", () => {
               if (pendingForm) {
                  pendingForm.submit();
               }
               hideModal();
            });

            cancelBtn?.addEventListener("click", hideModal);
            modal.addEventListener("click", (e) => {
               if (e.target === modal) {
                  hideModal();
               }
            });
         })();
      </script>
   </body>
</html>
