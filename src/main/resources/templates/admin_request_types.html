<!DOCTYPE html>
<html
   xmlns:th="https://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{base}"
>
   <head>
      <title>Διαχείριση Τύπων Αιτημάτων</title>
   </head>

   <body>
      <main layout:fragment="main" class="content-main container-sm">
         <h1 class="text-xl">Διαχείριση Τύπων Αιτημάτων</h1>
         <p class="muted" style="margin-bottom: 16px">
            Προσθήκη, ενεργοποίηση/απενεργοποίηση ή διαγραφή τύπων αιτημάτων.
         </p>

         <div th:if="${successMessage != null}" class="alert alert-success" th:text="${successMessage}"></div>
         <div th:if="${errorMessage != null}" class="alert alert-danger" th:text="${errorMessage}"></div>

         <div class="card-box">
            <h2 class="text-lg" style="margin-top: 0">Νέος Τύπος Αιτήματος</h2>
            <form th:action="@{/admin/request-types}" method="post" th:object="${requestTypeForm}">
               <div class="form-group">
                  <label class="form-label" for="protocolNumber">Πρωτόκολλο Τύπου</label>
                  <input class="form-control" id="protocolNumber" th:field="*{protocolNumber}" placeholder="π.χ. RT-KEP-010" />
                  <div class="error-message" th:if="${#fields.hasErrors('protocolNumber')}"
                     th:errors="*{protocolNumber}"></div>
               </div>
               <div class="form-group">
                  <label class="form-label" for="typeName">Όνομα</label>
                  <input class="form-control" id="typeName" th:field="*{name}" placeholder="π.χ. Ανανέωση Άδειας" />
                  <div class="error-message" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
               </div>
               <div class="form-group">
                  <label class="form-label" for="typeDescription">Περιγραφή</label>
                  <textarea class="form-textarea" id="typeDescription" rows="3" th:field="*{description}"
                     placeholder="Προαιρετική περιγραφή"></textarea>
                  <div class="error-message" th:if="${#fields.hasErrors('description')}"
                     th:errors="*{description}"></div>
               </div>
               <div class="form-group">
                  <label class="form-label" for="maxProcessingDays">Μέγιστες Ημέρες Εξυπηρέτησης</label>
                  <input class="form-control" id="maxProcessingDays" type="number" min="1" th:field="*{maxProcessingDays}"
                     placeholder="π.χ. 5" />
                  <div class="error-message" th:if="${#fields.hasErrors('maxProcessingDays')}"
                     th:errors="*{maxProcessingDays}"></div>
               </div>
               <div class="form-group">
                  <label class="form-label" for="departmentId">Τμήμα</label>
                  <select class="form-select" id="departmentId" th:field="*{departmentId}">
                     <option value="">-- Επιλογή Τμήματος --</option>
                     <option th:each="d : ${departments}" th:value="${d.id}" th:text="${d.name}"></option>
                  </select>
                  <div class="error-message" th:if="${#fields.hasErrors('departmentId')}" th:errors="*{departmentId}"></div>
               </div>
               <button type="submit" class="btn btn-primary text-md">
                  <i class="fas fa-plus-circle"></i> Προσθήκη Τύπου
               </button>
            </form>
         </div>

         <div class="card-box" style="margin-top: 20px">
            <div class="table-clean__header">
               <span>Υπάρχοντες Τύποι</span>
            </div>
            <div class="table-clean">
               <table>
                  <thead>
                     <tr>
                        <th>Πρωτόκολλο</th>
                        <th>Όνομα</th>
                        <th>Τμήμα</th>
                        <th>SLA (ημ.)</th>
                        <th class="status-cell">Κατάσταση</th>
                        <th style="width: 170px">Ενέργειες</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr th:each="rt : ${requestTypes}">
                        <td th:text="${rt.protocolNumber}">RT-XXX</td>
                        <td th:text="${rt.name}">Όνομα</td>
                        <td th:text="${rt.departmentName}">Τμήμα</td>
                        <td th:text="${rt.maxProcessingDays} ?: '-'">5</td>
                        <td class="status-cell">
                           <span class="status-pill" th:classappend="${rt.active} ? ' status-pill--success' : ' status-pill--danger'">
                              <span th:text="${rt.active} ? 'ΕΝΕΡΓΟ' : 'ΑΝΕΝΕΡΓΟ'">ΕΝΕΡΓΟ</span>
                           </span>
                        </td>
                        <td style="display: flex; gap: 6px; flex-wrap: wrap">
                           <form th:action="@{|/admin/request-types/${rt.id}/toggle|}" method="post">
                              <button type="submit" class="btn btn-sm"
                                 th:classappend="${rt.active} ? ' btn-warning' : ' btn-success'">
                                 <i class="fas" th:classappend="${rt.active} ? ' fa-toggle-off' : ' fa-toggle-on'"></i>
                                 <span th:text="${rt.active} ? 'Απενεργοποίηση' : 'Ενεργοποίηση'">Toggle</span>
                              </button>
                           </form>
                           <form th:action="@{|/admin/request-types/${rt.id}/delete|}" method="post"
                              onsubmit="return confirm('Διαγραφή τύπου αιτήματος;');">
                              <button type="submit" class="btn btn-danger btn-sm">
                                 <i class="fas fa-trash"></i> Διαγραφή
                              </button>
                           </form>
                        </td>
                     </tr>
                     <tr th:if="${requestTypes == null || requestTypes.isEmpty()}">
                        <td colspan="6" style="text-align: center; color: #777">Δεν υπάρχουν καταχωρημένοι τύποι αιτημάτων.</td>
                     </tr>
                  </tbody>
               </table>
            </div>
         </div>
      </main>
   </body>
</html>
