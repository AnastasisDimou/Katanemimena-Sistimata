<!DOCTYPE html>
<html
   xmlns:th="https://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{base}"
>
   <head>
      <title>Σύνδεση με Gov</title>

      <link rel="stylesheet" th:href="@{/style.css}" />

      <link
         href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
         rel="stylesheet"
      />
   </head>

   <body>
      <main layout:fragment="main" class="content-main">
         <div
            class="card-box text-center"
            style="max-width: 500px; margin: 0 auto"
         >
            <h1 style="margin-bottom: 20px">Σύνδεση με Gov</h1>

            <form th:action="@{/auth/gov/login}" method="post">
               <input
                  type="hidden"
                  th:if="${_csrf != null}"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
               />

               <div
                  th:if="${param.govError}"
                  class="error-message"
                  style="margin-bottom: 15px"
               >
                  Μη έγκυρα στοιχεία Gov (ΑΦΜ ή PIN).
               </div>

               <div
                  th:if="${param.govUnavailable}"
                  class="error-message"
                  style="margin-bottom: 15px"
               >
                  Η υπηρεσία Gov δεν είναι διαθέσιμη αυτή τη στιγμή. Δοκιμάστε
                  ξανά αργότερα.
               </div>

               <div class="form-group">
                  <label class="form-label" for="govAfm">ΑΦΜ</label>
                  <input
                     type="text"
                     id="govAfm"
                     name="afm"
                     class="form-control"
                     required
                     inputmode="numeric"
                     autocomplete="off"
                     pattern="^[0-9]{9}$"
                     title="Το ΑΦΜ πρέπει να έχει 9 ψηφία."
                     autofocus
                  />
               </div>

               <div class="form-group">
                  <label class="form-label" for="govPin">PIN</label>
                  <div class="password-container">
                     <input
                        type="password"
                        id="govPin"
                        name="pin"
                        class="form-control"
                        required
                        inputmode="numeric"
                        autocomplete="off"
                        pattern="^[0-9]{4,8}$"
                        title="Το PIN πρέπει να έχει 4 έως 8 ψηφία."
                     />
                     <span
                        class="togglePassword"
                        data-target="govPin"
                        role="button"
                        tabindex="0"
                     >
                        <i class="bx bx-hide"></i>
                     </span>
                  </div>
               </div>

               <button type="submit" class="btn btn-block btn-login-gov">
                  Σύνδεση
               </button>
            </form>

            <p style="margin-top: 16px">
               <a th:href="@{/login}" style="color: var(--primary-color)"
                  >Επιστροφή στη σύνδεση</a
               >
            </p>
         </div>

         <script>
            document.addEventListener("DOMContentLoaded", function () {
               document.querySelectorAll(".togglePassword").forEach((span) => {
                  const toggle = () => {
                     const targetId = span.getAttribute("data-target");
                     const targetInput = document.getElementById(targetId);
                     const icon = span.querySelector("i");
                     if (!targetInput || !icon) return;

                     if (targetInput.type === "password") {
                        targetInput.type = "text";
                        icon.classList.remove("bx-hide");
                        icon.classList.add("bx-show");
                     } else {
                        targetInput.type = "password";
                        icon.classList.remove("bx-show");
                        icon.classList.add("bx-hide");
                     }
                  };

                  span.addEventListener("click", toggle);
                  span.addEventListener("keydown", (e) => {
                     if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        toggle();
                     }
                  });
               });
            });
         </script>
      </main>
   </body>
</html>
