<!DOCTYPE html>
<html
   xmlns:th="https://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{base}"
>
   <head>
      <title>Εγγραφή</title>
   </head>

   <body>
      <main layout:fragment="main" class="content-main">
         <div class="card-box" style="max-width: 600px; margin: 0 auto">
            <h1 class="text-center" style="margin-bottom: 20px">
               Δημιουργία Λογαριασμού
            </h1>

            <form
               th:action="@{/register}"
               method="post"
               th:object="${createUserRequest}"
               id="registrationForm"
            >
               <!-- Global Error -->
               <div
                  th:if="${errorMessage}"
                  class="error-message text-center"
                  style="margin-bottom: 15px"
                  th:text="${errorMessage}"
               ></div>

               <!-- AFM -->
               <div class="form-group">
                  <label class="form-label">ΑΦΜ</label>
                  <input
                     type="text"
                     th:field="*{afm}"
                     class="form-control"
                     placeholder="123456789"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('afm')}"
                     th:errors="*{afm}"
                  ></div>
               </div>

               <!-- AMKA -->
               <div class="form-group">
                  <label class="form-label">ΑΜΚΑ</label>
                  <input
                     type="text"
                     th:field="*{amka}"
                     class="form-control"
                     placeholder="12345678901"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('amka')}"
                     th:errors="*{amka}"
                  ></div>
               </div>

               <!-- First name -->
               <div class="form-group">
                  <label class="form-label">Όνομα</label>
                  <input
                     type="text"
                     th:field="*{firstName}"
                     class="form-control"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('firstName')}"
                     th:errors="*{firstName}"
                  ></div>
               </div>

               <!-- Last name -->
               <div class="form-group">
                  <label class="form-label">Επώνυμο</label>
                  <input
                     type="text"
                     th:field="*{lastName}"
                     class="form-control"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('lastName')}"
                     th:errors="*{lastName}"
                  ></div>
               </div>

               <!-- Email -->
               <div class="form-group">
                  <label class="form-label">Email</label>
                  <input
                     type="email"
                     th:field="*{email}"
                     class="form-control"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('email')}"
                     th:errors="*{email}"
                  ></div>
               </div>

               <!-- Phone number -->
               <div class="form-group">
                  <label class="form-label">Τηλέφωνο</label>
                  <input
                     type="text"
                     th:field="*{phoneNumber}"
                     class="form-control"
                     placeholder="6912345678"
                  />
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('phoneNumber')}"
                     th:errors="*{phoneNumber}"
                  ></div>
               </div>

               <!-- Password Field -->
               <div class="form-group">
                  <label class="form-label" for="rawPassword">Κωδικός</label>
                  <div class="password-container">
                     <input
                        type="password"
                        id="rawPassword"
                        th:field="*{rawPassword}"
                        class="form-control"
                        required
                     />
                     <span class="togglePassword" data-target="rawPassword">
                        <i class="fas fa-eye-slash"></i>
                     </span>
                  </div>
                  <div
                     class="error-message"
                     th:if="${#fields.hasErrors('rawPassword')}"
                     th:errors="*{rawPassword}"
                  ></div>
               </div>

               <!-- Confirm Password Field -->
               <div class="form-group">
                  <label class="form-label" for="rawPasswordConfirm">
                     Επιβεβαίωση Κωδικού
                  </label>
                  <div class="password-container">
                     <input
                        type="password"
                        id="rawPasswordConfirm"
                        name="rawPasswordConfirm"
                        class="form-control"
                        required
                     />
                     <span
                        class="togglePassword"
                        data-target="rawPasswordConfirm"
                     >
                        <i class="fas fa-eye-slash"></i>
                     </span>
                  </div>
                  <div
                     class="error-message"
                     id="confirmPasswordError"
                     style="display: none"
                  >
                     Οι κωδικοί δεν ταιριάζουν.
                  </div>
               </div>

               <button type="submit" class="btn btn-block">Εγγραφή</button>
            </form>

            <p class="text-center" style="margin-top: 20px">
               Έχετε ήδη λογαριασμό;
               <a th:href="@{/login}" style="color: var(--primary-color)">
                  Συνδεθείτε
               </a>
            </p>
         </div>

         <script>
            document.addEventListener("DOMContentLoaded", function () {
               // Toggle password visibility for both fields
               document.querySelectorAll(".togglePassword").forEach((span) => {
                  span.addEventListener("click", function () {
                     const targetId = this.getAttribute("data-target");
                     const targetInput = document.getElementById(targetId);
                     const icon = this.querySelector("i");

                     const isPassword = targetInput.type === "password";
                     targetInput.type = isPassword ? "text" : "password";

                     icon.classList.toggle("fa-eye");
                     icon.classList.toggle("fa-eye-slash");
                  });
               });

               // Password confirmation validation
               const form = document.getElementById("registrationForm");
               const password = document.getElementById("rawPassword");
               const confirmPassword =
                  document.getElementById("rawPasswordConfirm");
               const errorDiv = document.getElementById("confirmPasswordError");

               form.addEventListener("submit", function (event) {
                  if (password.value !== confirmPassword.value) {
                     event.preventDefault();
                     errorDiv.style.display = "block";
                     confirmPassword.style.borderColor = "#d62828";
                  } else {
                     errorDiv.style.display = "none";
                     confirmPassword.style.borderColor = "#ddd";
                  }
               });

               confirmPassword.addEventListener("input", function () {
                  if (password.value === confirmPassword.value) {
                     errorDiv.style.display = "none";
                     confirmPassword.style.borderColor = "#ddd";
                  }
               });
            });
         </script>
      </main>
   </body>
</html>
